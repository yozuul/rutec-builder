import{E as I,a as R}from"./el-table.f8529865.js";import{b as M}from"./el-select.99d9b097.js";import{E as V}from"./el-button.4b28c0d2.js";import{e as j,d as K,E as L}from"./index.4edc3df1.js";import{_ as O}from"./nuxt-link.856c34ed.js";import{E as q}from"./el-pagination.6c7486ac.js";import{a as G,_ as H}from"./layout.44602910.js";import"./base.2bb6cb54.js";import"./el-checkbox.2154bfa8.js";import"./el-scrollbar.1c121719.js";/* empty css                */import"./el-tooltip.4ed993c7.js";import"./el-popper.8acabd0f.js";import"./el-input.af81951a.js";import{E as J}from"./el-overlay.90f58aaa.js";import{E as x}from"./el-message.6dbc9361.js";import{u as Q}from"./partnerStore.d9878ca3.js";import{p as U,s as b,r as u,z as W,o as X,c as Y,e as a,f as e,u as n,j as w,t as Z}from"./entry.18e2495c.js";import"./aria.e146d83a.js";import"./_Uint8Array.bec00609.js";import"./_initCloneObject.e22dfabd.js";import"./isEqual.da90e6c9.js";import"./event.9519ab40.js";import"./validator.fc99fe8a.js";import"./typescript.defaf979.js";import"./el-card.c774d930.js";import"./vnode.21d4e520.js";import"./api.config.665f63bb.js";import"./cookie.3290b875.js";const Dt=U({__name:"index",async setup(tt){let p,_;const m=Q();try{[p,_]=b(()=>m.fetchAllPartners()),await p,_(),[p,_]=b(()=>m.fetchCity()),await p,_()}catch(t){console.log(t)}const y=u([]);let v=new Set;m.partners.map(t=>{v.add(t.city.name)}),y.value=Array.from(v).map(t=>({text:t,value:t}));const g=u(),C=()=>{g.value.clearFilter()},E=(t,o)=>o.city===t,k=(t,o)=>o.companyType===t,T=(t,o)=>o.status===t;let f=m.partners.map(t=>({...t,city:t.city.name}));const r=u(50),l=u(1);let s=u([]);W(()=>{s.value=f.slice((l.value-1)*r.value,l.value*r.value)});const z=t=>{r.value=t,s.value=f.slice((l.value-1)*r.value,l.value*r.value)},S=t=>{l.value=t,s.value=f.slice((l.value-1)*r.value,l.value*r.value)},B=async t=>{try{await J.confirm("Уверены, что хотите удалить партнёра?","Внимание!",{cancelButtonText:"Отмена",confirmButtonText:"OK",type:"warning"});try{await m.deletePartner(t),s.value=s.value.filter(o=>o.id!==t),x({type:"success",message:`Партнёр с ID ${t} удалён`})}catch{x({type:"error",message:`При удалении партнёра с ID ${t}  возникла ошибка`})}}catch{console.log("Удаление отменено")}};return(t,o)=>{const i=I,P=M,d=V,h=L,D=O,N=R,$=q,A=G,F=H;return X(),Y(F,null,{default:a(()=>[e(A,{title:"Партнёры",buttonText:"Добавить партнёра",buttonRoute:"/admin/partners/add"},{default:a(()=>[e(N,{ref_key:"tableRef",ref:g,"row-key":"companyName",data:n(s),style:{width:"100%"}},{default:a(()=>[e(i,{prop:"companyName",label:"Название",sortable:"","column-key":"companyName"}),e(i,{width:"180",prop:"city",label:"Город",sortable:"","column-key":"city",filters:n(y),"filter-method":E},null,8,["filters"]),e(i,{width:"160",prop:"companyType",label:"Тип",sortable:"","column-key":"companyType",filters:[{text:"Автосервис",value:"Автосервис"},{text:"Магазин",value:"Магазин"},{text:"Предприятие",value:"Предприятие"}],"filter-method":k}),e(i,{prop:"email",label:"Email",width:"250"}),e(i,{prop:"status",label:"Статус",width:"130",sortable:"","column-key":"status",filters:[{text:"Одобрен",value:"Одобрен"},{text:"Ожидает",value:"Ожидает"},{text:"Отклонён",value:"Отклонён"}],"filter-method":T,"filter-placement":"bottom-end"},{default:a(c=>[e(P,{type:c.row.status==="Одобрен"?"success":c.row.status==="Отклонён"?"danger":"","disable-transitions":""},{default:a(()=>[w(Z(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e(i,{width:"160",align:"right"},{header:a(()=>[e(d,{size:"small",onClick:C},{default:a(()=>[w("Очистить фильтры")]),_:1})]),default:a(c=>[e(D,{to:`/admin/partners/${c.row.id}`},{default:a(()=>[e(d,{size:"small"},{default:a(()=>[e(h,null,{default:a(()=>[e(n(j))]),_:1})]),_:1})]),_:2},1032,["to"]),e(d,{class:"deleteProductBtn",size:"small",type:"danger",onClick:et=>B(c.row.id)},{default:a(()=>[e(h,null,{default:a(()=>[e(n(K))]),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e($,{onSizeChange:z,onCurrentChange:S,"current-page":n(l),"page-size":n(r),layout:"prev, pager, next",total:n(f).length},null,8,["current-page","page-size","total"])]),_:1})]),_:1})}}});export{Dt as default};
